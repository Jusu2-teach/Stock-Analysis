# AStock Analysis System

![Python](https://img.shields.io/badge/Python-3.9%2B-blue)
![Architecture](https://img.shields.io/badge/Architecture-Modular-green)
![Engine](https://img.shields.io/badge/Engine-DuckDB%20%7C%20Polars-orange)

AStock Analysis æ˜¯ä¸€ä¸ªç°ä»£åŒ–ã€é«˜æ€§èƒ½çš„ **Aè‚¡åŸºæœ¬é¢é‡åŒ–åˆ†æç³»ç»Ÿ**ã€‚å®ƒé‡‡ç”¨ **Orchestrator (è°ƒåº¦å™¨) + Pipeline (ç¼–æ’å™¨) + Business Plugins (ä¸šåŠ¡æ’ä»¶)** çš„åˆ†å±‚æ¶æ„ï¼Œä¸“æ³¨äºé€šè¿‡**å¤šå¹´è´¢åŠ¡æ•°æ®çš„è¶‹åŠ¿åˆ†æ**ï¼Œç­›é€‰ä¼˜è´¨ä¼ä¸šã€è¯†åˆ«å›°å¢ƒåè½¬ã€é¢„è­¦é£é™©å…¬å¸ã€‚

---

## ğŸ¯ ç³»ç»ŸåŠŸèƒ½

### æ ¸å¿ƒåˆ†æèƒ½åŠ›
| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| **è¶‹åŠ¿åˆ†æå¼•æ“** | åŸºäºå¯¹æ•°å›å½’ã€Mann-Kendallæ£€éªŒç­‰ç»Ÿè®¡æ–¹æ³•ï¼Œåˆ†æè´¢åŠ¡æŒ‡æ ‡çš„é•¿æœŸè¶‹åŠ¿ |
| **å¤šå› å­è¯„åˆ†** | æˆé•¿å› å­(30%) + è´¨é‡å› å­(40%) + å®‰å…¨å› å­(30%) çš„ç»¼åˆè¯„åˆ†ä½“ç³» |
| **è§„åˆ™å¼•æ“** | 31æ¡è§„åˆ™ (7æ¡ä¸€ç¥¨å¦å†³ + 10æ¡æ‰£åˆ† + 6æ¡äº¤å‰éªŒè¯ + 3æ¡å‘¨æœŸæ€§ + 5æ¡åŠ åˆ†) |
| **ç­–ç•¥è¯†åˆ«** | è‡ªåŠ¨è¯†åˆ«5ç§æŠ•èµ„ç­–ç•¥ï¼šé«˜æˆé•¿ã€å›°å¢ƒåè½¬ã€ç¨³å®šåˆ†çº¢ã€å‘¨æœŸåº•éƒ¨ã€æŠ¤åŸæ²³é˜²å¾¡ |
| **é£é™©é¢„è­¦** | æ£€æµ‹çº¸é¢å¯Œè´µ(åˆ©æ¶¦vsç°é‡‘æµèƒŒç¦»)ã€ä½æ•ˆæ‰©å¼ (é«˜å¢é•¿ä½ROE)ç­‰é£é™© |

### è¾“å‡ºæŠ¥å‘Š
- ğŸ“Š **ä¼˜è´¨å…¬å¸ç²¾é€‰** - æŒ‰è¶…å¤§å‹/å¤§å‹/ä¸­å‹åˆ†ç±»å±•ç¤º
- ğŸ° **ç™½é©¬æŠ¤åŸæ²³** - é«˜ROEã€é«˜ROICã€é«˜æ¯›åˆ©ç‡çš„è¡Œä¸šé¾™å¤´
- ğŸš€ **å›°å¢ƒåè½¬æœºä¼š** - åŸºæœ¬é¢è§¦åº•å›å‡çš„æ½œåŠ›è‚¡
- âš ï¸ **é£é™©è­¦ç¤º** - è´¢åŠ¡æŒ‡æ ‡å¼‚å¸¸çš„å…¬å¸
- ğŸ­ **è¡Œä¸šæ™¯æ°”åº¦** - å…¨è¡Œä¸šæ¨ªå‘å¯¹æ¯”

---

## ğŸŒŸ æ ¸å¿ƒæ¶æ„

ç³»ç»Ÿç”±ä¸‰å¤§ç‹¬ç«‹ä¸”æ¾è€¦åˆçš„æ¨¡å—ç»„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orchestrator (è°ƒåº¦å±‚)                     â”‚
â”‚         è‡ªåŠ¨å‘ç° Â· ç»Ÿä¸€é—¨é¢ Â· ç­–ç•¥è·¯ç”± Â· ç‰ˆæœ¬ç®¡ç†              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Pipeline (ç¼–æ’å±‚)                        â”‚
â”‚          YAMLé…ç½®é©±åŠ¨ Â· æ–­ç‚¹ç»­ä¼  Â· ç¼“å­˜æœºåˆ¶ Â· æŒ‡æ ‡ç›‘æ§         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AStock Business Engines (ä¸šåŠ¡å±‚)                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è¶‹åŠ¿åˆ†æå™¨    â”‚  â”‚  è¯„åˆ†å¼•æ“     â”‚  â”‚  æŠ¥å‘Šç”Ÿæˆå™¨   â”‚      â”‚
â”‚  â”‚ TrendAnalyzerâ”‚  â”‚ QualityScorerâ”‚  â”‚ReportGeneratorâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  DuckDBå¼•æ“  â”‚  â”‚  Polarså¼•æ“   â”‚  â”‚  è§„åˆ™å¼•æ“    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Orchestrator (æ ¸å¿ƒè°ƒåº¦å±‚)
ç³»ç»Ÿçš„"å¤§è„‘"å’ŒæœåŠ¡æ€»çº¿ã€‚
-   **è‡ªåŠ¨å‘ç° (Auto-Discovery)**: å¼•å…¥æ™ºèƒ½ `Scanner`ï¼Œä¸šåŠ¡ä»£ç æ— éœ€æ‰‹åŠ¨æ³¨å†Œï¼Œéµå¾ªçº¦å®šå³å¯è‡ªåŠ¨æŒ‚è½½ã€‚
-   **ç»Ÿä¸€é—¨é¢ (Facade)**: æä¾›ç»Ÿä¸€çš„ API è°ƒç”¨æ¥å£ï¼Œå±è”½åº•å±‚å®ç°ç»†èŠ‚ã€‚
-   **ç­–ç•¥è·¯ç”±**: æ”¯æŒå¤šç§æ‰§è¡Œç­–ç•¥ï¼ˆå¦‚ä¼˜å…ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ã€ç‰¹å®šå¼•æ“ç­‰ï¼‰ã€‚

### 2. Pipeline (æµç¨‹ç¼–æ’å±‚)
ç³»ç»Ÿçš„"éª¨æ¶"å’Œæ‰§è¡Œå¼•æ“ã€‚
-   **æ··åˆå¼•æ“ (Hybrid Engine)**: ç»“åˆäº† **Prefect** çš„ä»»åŠ¡è°ƒåº¦èƒ½åŠ›å’Œ **Kedro** çš„æ•°æ®æµç®¡ç†èƒ½åŠ›ã€‚
-   **é…ç½®é©±åŠ¨**: é€šè¿‡ YAML æ–‡ä»¶å®šä¹‰å¤æ‚çš„å·¥ä½œæµ (`workflow/*.yaml`)ã€‚
-   **å¥å£®æ€§**: æ”¯æŒæ–­ç‚¹ç»­ä¼  (`--resume`)ã€ç¼“å­˜æœºåˆ¶ã€ä¾èµ–è‡ªåŠ¨è§£æå’Œè¯¦ç»†çš„æ‰§è¡ŒæŒ‡æ ‡ã€‚

### 3. AStock Business Engines (ä¸šåŠ¡é€»è¾‘å±‚)
ç³»ç»Ÿçš„"è¡€è‚‰"ï¼Œçº¯å‡€çš„ä¸šåŠ¡å®ç°ã€‚
-   **é›¶ä¾µå…¥æ€§**: ä¸šåŠ¡ä»£ç ï¼ˆå¦‚ `src/astock`ï¼‰å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¾èµ–æ¡†æ¶ä»£ç ã€‚
-   **é«˜æ€§èƒ½**: å†…ç½® DuckDB å’Œ Polars å¼•æ“ï¼Œæ”¯æŒ SQL çº§å’Œå‘é‡åŒ–çš„é«˜é€Ÿè®¡ç®—ã€‚
-   **å³æ’å³ç”¨**: ç¼–å†™æ™®é€š Python å‡½æ•°å³å¯è¢«ç³»ç»Ÿè¯†åˆ«ä¸ºä¸šåŠ¡èƒ½åŠ›ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.9+
- ä¾èµ–åŒ…: è§ `requirements.txt`

### å®‰è£…
```bash
pip install -r requirements.txt
```

### è¿è¡Œåˆ†æ
```bash
# 1. è¿è¡Œå®Œæ•´çš„è¶‹åŠ¿åˆ†æå·¥ä½œæµ
python pipeline/main.py run -c workflow/duckdb_screen.yaml

# 2. ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Š
python -c "from src.astock.business_engines.reporters.comprehensive_generator import ComprehensiveReportGenerator; ComprehensiveReportGenerator().generate_report()"

# æŠ¥å‘Šè¾“å‡ºè‡³: data/filter_middle/comprehensive_analysis_report.md
```

### å…¶ä»–å‘½ä»¤
```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
python pipeline/main.py status

# æŸ¥çœ‹å¯ç”¨å¼•æ“
python pipeline/main.py engines

# æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
python pipeline/main.py metrics -c workflow/duckdb_screen.yaml

# æ¸…ç†ç¼“å­˜
python pipeline/main.py cache clear
```

---

## ğŸ“Š æ•°æ®è¦æ±‚ (é‡è¦)

### è¾“å…¥æ•°æ®æ–‡ä»¶
ç³»ç»Ÿé»˜è®¤è¯»å– `data/polars/5yd_final_industry.csv`ï¼Œæ”¯æŒ **â‰¥3å¹´** çš„æ—¶åºè´¢åŠ¡æ•°æ®ã€‚

### å¿…éœ€å­—æ®µ (Required Fields)

#### 1ï¸âƒ£ æ ‡è¯†å­—æ®µ (å¿…éœ€)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `ts_code` | string | è‚¡ç¥¨ä»£ç  (å”¯ä¸€æ ‡è¯†) | `000001.SZ` |
| `name` | string | å…¬å¸åç§° | `å¹³å®‰é“¶è¡Œ` |
| `industry` | string | æ‰€å±è¡Œä¸š | `é“¶è¡Œ` |
| `end_date` | string/int | æŠ¥å‘ŠæœŸæœ«æ—¥æœŸ (å¹´ä»½æ ‡è¯†) | `20231231` |

#### 2ï¸âƒ£ æ ¸å¿ƒæ•ˆç‡æŒ‡æ ‡ (è¶‹åŠ¿åˆ†æå¿…éœ€)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç”¨é€” |
|--------|------|------|------|
| `roic` | float | æŠ•å…¥èµ„æœ¬å›æŠ¥ç‡ (%) | **æ ¸å¿ƒç­›é€‰æŒ‡æ ‡**ï¼Œè¡¡é‡èµ„æœ¬æ•ˆç‡ |
| `roe` | float | å‡€èµ„äº§æ”¶ç›Šç‡ (%) | è‚¡ä¸œå›æŠ¥è§†è§’ï¼Œäº¤å‰éªŒè¯ROIC |
| `grossprofit_margin` | float | æ¯›åˆ©ç‡ (%) | æŠ¤åŸæ²³æŒ‡æ ‡ï¼Œäº§å“ç«äº‰åŠ› |
| `netprofit_margin` | float | å‡€åˆ©ç‡ (%) | ç›ˆåˆ©èƒ½åŠ›æŒ‡æ ‡ |

#### 3ï¸âƒ£ è§„æ¨¡å¢é•¿æŒ‡æ ‡ (è¶‹åŠ¿åˆ†æå¿…éœ€)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç”¨é€” |
|--------|------|------|------|
| `eps` | float | æ¯è‚¡æ”¶ç›Š (å…ƒ) | ç›ˆåˆ©å¢é•¿è¶‹åŠ¿ |
| `total_revenue_ps` | float | æ¯è‚¡è¥æ”¶ (å…ƒ) | è¥æ”¶å¢é•¿è¶‹åŠ¿ |
| `ocfps` | float | æ¯è‚¡ç»è¥ç°é‡‘æµ (å…ƒ) | **ç›ˆåˆ©è´¨é‡éªŒè¯**ï¼Œæ£€æµ‹çº¸é¢å¯Œè´µ |

#### 4ï¸âƒ£ èµ„æœ¬ç»“æ„å­—æ®µ (è§„æ¨¡åˆ†ç±»å¿…éœ€)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç”¨é€” |
|--------|------|------|------|
| `invest_capital` | float | æŠ•å…¥èµ„æœ¬ (å…ƒ) | **è§„æ¨¡åˆ†ç±»**çš„æ ¸å¿ƒä¾æ® |

### å¯é€‰å­—æ®µ (Optional Fields)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç”¨é€” |
|--------|------|------|------|
| `roiic` | float | å¢é‡æŠ•å…¥èµ„æœ¬å›æŠ¥ç‡ (%) | è¯„ä¼°æ–°æŠ•èµ„æ•ˆç‡ (éœ€è‡ªè¡Œè®¡ç®—) |
| `bps` | float | æ¯è‚¡å‡€èµ„äº§ (å…ƒ) | ä»·å€¼è¯„ä¼°å‚è€ƒ |
| `debt_to_assets` | float | èµ„äº§è´Ÿå€ºç‡ (%) | è´¢åŠ¡é£é™©è¯„ä¼° |
| `current_ratio` | float | æµåŠ¨æ¯”ç‡ | çŸ­æœŸå¿å€ºèƒ½åŠ› |
| `fcff` | float | è‡ªç”±ç°é‡‘æµ (å…ƒ) | ç°é‡‘åˆ›é€ èƒ½åŠ› |
| `symbol` | string | è‚¡ç¥¨ç®€ç  | è¾…åŠ©æ ‡è¯† |
| `area` | string | æ‰€åœ¨åœ°åŒº | åœ°åŒºåˆ†æ |
| `list_date` | string | ä¸Šå¸‚æ—¥æœŸ | ä¸Šå¸‚æ—¶é•¿åˆ†æ |

### æ•°æ®æ ¼å¼ç¤ºä¾‹

```csv
ts_code,name,industry,end_date,roic,roe,grossprofit_margin,netprofit_margin,eps,total_revenue_ps,ocfps,invest_capital
000001.SZ,å¹³å®‰é“¶è¡Œ,é“¶è¡Œ,20201231,12.5,15.2,45.3,32.1,1.52,25.6,2.1,150000000000
000001.SZ,å¹³å®‰é“¶è¡Œ,é“¶è¡Œ,20211231,13.1,16.0,46.1,33.2,1.68,28.3,2.3,160000000000
000001.SZ,å¹³å®‰é“¶è¡Œ,é“¶è¡Œ,20221231,12.8,15.5,44.8,31.5,1.61,27.1,2.0,165000000000
000001.SZ,å¹³å®‰é“¶è¡Œ,é“¶è¡Œ,20231231,13.5,16.2,47.2,34.0,1.75,29.5,2.5,170000000000
000001.SZ,å¹³å®‰é“¶è¡Œ,é“¶è¡Œ,20241231,14.0,17.0,48.5,35.5,1.88,31.2,2.8,180000000000
```

### æ•°æ®å¹´ä»½è¦æ±‚

| å¹´ä»½æ•° | æ”¯æŒæƒ…å†µ | åˆ†æèƒ½åŠ› |
|--------|---------|---------|
| 3å¹´ | âœ… æœ€å°æ”¯æŒ | åŸºç¡€è¶‹åŠ¿åˆ†æ |
| 5å¹´ | âœ… **æ¨è** | å®Œæ•´è¶‹åŠ¿+æ‹ç‚¹æ£€æµ‹ |
| 6-10å¹´ | âœ… æ”¯æŒ | é•¿å‘¨æœŸåˆ†æ |
| >10å¹´ | âœ… æ”¯æŒ | è¶…é•¿å‘¨æœŸåˆ†æ |

> âš ï¸ **é‡è¦**: ç³»ç»Ÿè‡ªåŠ¨é€‚åº”æ•°æ®å¹´ä»½ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚åªè¦æ¯å®¶å…¬å¸æœ‰ â‰¥3 å¹´è¿ç»­æ•°æ®å³å¯ã€‚

---

## ğŸ”§ è§„æ¨¡åˆ†ç±»æ ‡å‡†

ç³»ç»Ÿæ ¹æ® `invest_capital` (æŠ•å…¥èµ„æœ¬) è‡ªåŠ¨åˆ†ç±»å…¬å¸è§„æ¨¡ï¼š

| åˆ†ç±» | æŠ•å…¥èµ„æœ¬èŒƒå›´ | æ ‡ç­¾ | æŠ•èµ„ç‰¹ç‚¹ |
|------|-------------|------|---------|
| å¾®å‹ (Micro) | < 10äº¿ | ğŸ”¹ | æµåŠ¨æ€§å·®ï¼Œé£é™©æé«˜ |
| å°å‹ (Small) | 10-50äº¿ | ğŸ”¸ | æˆé•¿ç©ºé—´å¤§ï¼Œæ³¢åŠ¨å‰§çƒˆ |
| ä¸­å‹ (Mid) | 50-200äº¿ | ğŸ”¶ | ç›¸å¯¹ç¨³å¥ï¼Œæœºæ„å…³æ³¨ |
| å¤§å‹ (Large) | 200-1000äº¿ | ğŸ”· | è¡Œä¸šé¾™å¤´ï¼ŒæµåŠ¨æ€§å¥½ |
| è¶…å¤§å‹ (Mega) | > 1000äº¿ | ğŸ’ | è“ç­¹ç™½é©¬ï¼Œç¨³å®šæ€§æœ€é«˜ |

> ğŸ“Œ æŠ¥å‘Šä¸­ä»…å±•ç¤º **ä¸­å‹ã€å¤§å‹ã€è¶…å¤§å‹** å…¬å¸ï¼Œå°å‹å’Œå¾®å‹å› é£é™©è¿‡é«˜è¢«è¿‡æ»¤ã€‚

---

## ğŸ“ˆ è¶‹åŠ¿åˆ†ææ–¹æ³•

### æ ¸å¿ƒç®—æ³•
| ç®—æ³• | ç”¨é€” |
|------|------|
| **å¯¹æ•°çº¿æ€§å›å½’** | è®¡ç®— log_slopeï¼Œæ•æ‰å¤åˆå¢é•¿è¶‹åŠ¿ |
| **Mann-Kendall æ£€éªŒ** | éå‚æ•°è¶‹åŠ¿æ£€éªŒï¼ŒæŠ—å¼‚å¸¸å€¼ |
| **Theil-Sen ä¼°è®¡** | é²æ£’æ–œç‡ä¼°è®¡ |
| **åˆ†æ®µå›å½’** | æ‹ç‚¹æ£€æµ‹ï¼Œè¯†åˆ«è¶‹åŠ¿åè½¬ |
| **æ»šåŠ¨çª—å£åˆ†æ** | è¿‘3å¹´ vs å…¨å‘¨æœŸå¯¹æ¯”ï¼Œæ£€æµ‹åŠ é€Ÿ/å‡é€Ÿ |

### è¯„åˆ†ä½“ç³»

```
ç»¼åˆè¯„åˆ† = æˆé•¿åˆ†Ã—30% + è´¨é‡åˆ†Ã—40% + å®‰å…¨åˆ†Ã—30%

æˆé•¿åˆ†: è¥æ”¶CAGRæ’å + åˆ©æ¶¦CAGRæ’å + è¶‹åŠ¿åŠ é€Ÿåº¦
è´¨é‡åˆ†: ROEæ’å + ROICæ’å + æ¯›åˆ©ç‡æ’å + ç¨³å®šæ€§
å®‰å…¨åˆ†: ç°é‡‘æµè¦†ç›–ç‡ + ç°é‡‘æµè¶‹åŠ¿ + è´Ÿå€ºæ°´å¹³
```

### ç­–ç•¥è¯†åˆ«

| ç­–ç•¥ | è¯†åˆ«æ¡ä»¶ |
|------|---------|
| **é«˜æˆé•¿** | CAGR>20%, è¶‹åŠ¿æ–œç‡>0.15, RÂ²>0.7 |
| **å›°å¢ƒåè½¬** | å†å²äºæŸâ†’æœ€æ–°ç›ˆåˆ©, è¿‘3å¹´æ–œç‡è½¬æ­£ |
| **æŠ¤åŸæ²³** | ROE>15%, ROIC>12%, æ¯›åˆ©ç‡>30%, ç¨³å®š5å¹´ |
| **å‘¨æœŸåº•éƒ¨** | å‘¨æœŸæ€§è¡Œä¸š, å¤„äºå†å²ä½ä½, è¶‹åŠ¿è§åº• |
| **ç¨³å®šåˆ†çº¢** | ROEç¨³å®š, ç°é‡‘æµå……æ²›, æ³¢åŠ¨ç‡ä½ |

---

## ğŸ“‚ ç›®å½•ç»“æ„

```text
AStock-Analysis/
â”œâ”€â”€ orchestrator/           # [Core] è°ƒåº¦ä¸æ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ registry/           # ç»„ä»¶æ³¨å†Œè¡¨
â”‚   â””â”€â”€ decorators/         # è£…é¥°å™¨
â”œâ”€â”€ pipeline/               # [Core] æµç¨‹æ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ engines/            # Prefect/Kedro å¼•æ“
â”‚   â””â”€â”€ main.py             # CLI å…¥å£
â”œâ”€â”€ src/astock/             # [Plugin] ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ business_engines/
â”‚   â”‚   â”œâ”€â”€ analyzers/      # è¶‹åŠ¿åˆ†æå™¨
â”‚   â”‚   â”‚   â””â”€â”€ trend/      # è¶‹åŠ¿åˆ†ææ ¸å¿ƒ
â”‚   â”‚   â”‚       â”œâ”€â”€ probes/ # æ¢é’ˆ (Log/Rolling/Inflection/Deterioration)
â”‚   â”‚   â”‚       â”œâ”€â”€ rules.py    # 31æ¡è§„åˆ™å¼•æ“
â”‚   â”‚   â”‚       â””â”€â”€ strategies.py # 5ç§ç­–ç•¥è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ reporters/      # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â”‚   â””â”€â”€ scorers/        # è¯„åˆ†å¼•æ“
â”‚   â””â”€â”€ data_engines/       # æ•°æ®å¼•æ“ (DuckDB/Polars)
â”œâ”€â”€ workflow/               # [Config] YAML å·¥ä½œæµ
â”‚   â”œâ”€â”€ duckdb_screen.yaml  # ä¸»åˆ†ææµç¨‹
â”‚   â””â”€â”€ tushare_fina.yaml   # æ•°æ®è·å–æµç¨‹
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ polars/             # åŸå§‹æ•°æ®
â”‚   â”‚   â””â”€â”€ 5yd_final_industry.csv  # è¾“å…¥æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ filter_middle/      # ä¸­é—´ç»“æœ
â”‚       â”œâ”€â”€ roic_trend_analysis.csv
â”‚       â”œâ”€â”€ roe_trend_analysis.csv
â”‚       â””â”€â”€ comprehensive_analysis_report.md  # è¾“å‡ºæŠ¥å‘Š
â””â”€â”€ requirements.txt
```

---

## ğŸ’» å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„åˆ†ææŒ‡æ ‡

1. åœ¨ `workflow/duckdb_screen.yaml` ä¸­æ·»åŠ æ–°çš„åˆ†ææ­¥éª¤ï¼š
```yaml
- name: "Analyze_NEW_METRIC_Trend"
  component: "business_engine"
  engine: "duckdb"
  method: ["analyze_metric_trend"]
  parameters:
    data: "steps.Load_Financial_Data.outputs.parameters.Raw_Data"
    group_cols: 'ts_code'
    metric_name: 'new_metric'  # CSVä¸­çš„åˆ—å
    min_periods: 3
```

2. åœ¨æŠ¥å‘Šç”Ÿæˆå™¨ä¸­æ·»åŠ æŒ‡æ ‡é…ç½® (`comprehensive_generator.py`)ï¼š
```python
self.metrics_config = {
    ...
    "new_metric": {"file": "new_metric_trend_analysis.csv", "prefix": "new_metric", "name": "æ–°æŒ‡æ ‡"},
}
```

### è‡ªå®šä¹‰è§„åˆ™

åœ¨ `src/astock/business_engines/analyzers/trend/rules.py` ä¸­æ·»åŠ æ–°è§„åˆ™ï¼š
```python
def my_custom_rule(context: RuleContext, thresholds: ThresholdConfig) -> Optional[RuleResult]:
    """è‡ªå®šä¹‰è§„åˆ™"""
    if context.some_condition:
        return RuleResult("my_rule", "penalty", "æ‰£åˆ†åŸå› ", penalty_value=10)
    return None
```

---

## ğŸ“„ License

MIT License

---

## ğŸ™ è‡´è°¢

- [Tushare](https://tushare.pro/) - Aè‚¡æ•°æ®æº
- [DuckDB](https://duckdb.org/) - é«˜æ€§èƒ½åˆ†ææ•°æ®åº“
- [Polars](https://pola.rs/) - é«˜æ€§èƒ½æ•°æ®å¤„ç†åº“
- [Prefect](https://www.prefect.io/) - å·¥ä½œæµç¼–æ’å¼•æ“
