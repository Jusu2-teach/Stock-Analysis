# AStock 综合研报生成引擎 (Comprehensive Reporting Engine)

> **版本**: 2.0 (2025-11)
> **定位**: 自动化投资研报生成器
> **核心理念**: "数据驱动决策，交叉验证排雷"

---

## 1. 模块简介 (Introduction)

本模块 (`reporting`) 是 AStock 系统的"输出端"。它不再局限于生成单一指标的 CSV 文件，而是像一位经验丰富的分析师一样，将所有中间分析结果（营收、利润、现金流、ROE 等）汇总起来，进行深度的**交叉验证**和**综合打分**，最终生成一份人类可读的 Markdown 研报。

---

## 2. 核心原理与筛选标准 (Core Logic & Criteria)

本模块通过 `ComprehensiveReportGenerator` 类实现，其核心逻辑分为四个板块：

### 2.1 🏆 皇冠上的明珠 (Top Picks)
**目标**: 寻找"六边形战士" —— 既有高成长，又有高质量，还很安全。

**筛选标准 (必须全部满足)**:
1.  **高成长性**:
    *   `营收` 或 `利润` 被判定为 "High Growth" (增速>20% 且 趋势显著)。
2.  **高质量护城河**:
    *   `ROE` (净资产收益率) > 10% (且趋势向上)。
    *   `ROIC` (投入资本回报率) > 8%。
3.  **高安全性**:
    *   `经营现金流` (OCF) 趋势未恶化 (Slope > -0.05)。

**排序规则**:
*   计算 `composite_score` (综合评分) = 营收、利润、ROE、ROIC 四项趋势评分的均值。
*   取前 **30** 名。

### 2.2 🏰 优质白马与护城河 (Quality Moat)
**目标**: 寻找"稳稳的幸福" —— 业绩未必爆发，但盈利能力极强，护城河深厚。

**筛选标准**:
1.  **极高盈利能力**: `ROE` > 15% 且 `毛利率` > 30%。
2.  **稳健增长**: 营收和利润均为正增长 (Slope > 0)，不要求极高增速。
3.  **现金流安全**: 经营现金流为正。

**投资逻辑**:
*   此类企业通常是行业龙头，适合在市场恐慌、估值回调时买入，长期持有。

### 2.3 🚀 困境反转机会 (Turnaround)
**目标**: 寻找基本面触底回升的潜力股。

**筛选标准**:
1.  **反转信号**: `营收` 或 `利润` 被判定为 "Turnaround" (V型反转 或 扭亏为盈)。
2.  **质量确认**: `毛利率` 趋势未恶化 (Slope > -0.02)。
    *   *原理*: 防止公司通过"大降价清库存"带来的虚假营收回升。只有毛利稳住的增长才是真反转。

**关于"重叠"的说明**:
*   **Q: 为什么一家公司可能同时出现在"高增长"和"困境反转"名单中？**
*   **A**: 这通常发生在**"爆发式复苏"**的公司身上。
    *   例如：某公司去年亏损（触发 Turnaround 关注），但今年利润暴涨 200% 且 ROE 飙升至 15%（触发 High Growth 标准）。
    *   这种情况并不矛盾，反而说明该公司的反转力度极强，直接冲进了优质股行列，值得重点关注。

### 2.3 ⚠️ 交叉验证风险 (Risk Warnings)
**目标**: 识别财务造假嫌疑和低质量增长。

**识别逻辑**:
1.  **纸面富贵 (Paper Wealth)**:
    *   利润高速增长 (>15%) **BUT** 经营现金流恶化 (<-5%)。
    *   *风险*: 利润可能是通过赊销（应收账款）堆出来的，收不到钱。
2.  **低效扩张 (Inefficient Expansion)**:
    *   营收高速增长 (>20%) **BUT** ROE 极低 (<5%)。
    *   *风险*: 增长靠烧钱融资，股东回报率极低，属于"有毒增长"。

### 2.4 🏭 行业景气度 (Industry Heatmap)
**目标**: 识别当前最火热的赛道。
*   **算法**: 计算各行业内所有公司的 `营收增速` 和 `利润增速` 的中位数，相加得到行业景气分，取 Top 10。

---

## 3. 使用指南 (Usage)

### 3.1 自动运行
本模块已集成到主 Pipeline 中。每次运行 `duckdb_screen.yaml` 后，会自动在 `data/` 目录下生成：
*   `comprehensive_analysis_report.md`

### 3.2 手动调用 (开发调试)
```python
from astock.business_engines.reporting.comprehensive_generator import ComprehensiveReportGenerator

# 初始化生成器，指定数据目录
generator = ComprehensiveReportGenerator(data_dir="data/filter_middle")

# 生成报告
report = generator.generate_report(output_path="data/my_report.md")
print(report)
```

---

**维护者**: Jusu2-teach
**最后更新**: 2025-11-29
