# ğŸ“¦ Orchestrator æ¶æ„æ–‡æ¡£

> **ç›®æ ‡è¯»è€…**ï¼šæ–°æ‰‹å¼€å‘è€…
> **ç”¨é€”**ï¼šç†è§£ Orchestrator æ˜¯ä»€ä¹ˆã€å¦‚ä½•å·¥ä½œã€å¦‚ä½•ä½¿ç”¨

---

## ğŸ¯ ä¸€å¥è¯æ¦‚æ‹¬

**Orchestrator æ˜¯ä¸€ä¸ª"æ–¹æ³•æ³¨å†Œä¸è°ƒç”¨ä¸­å¿ƒ"** â€”â€” æŠŠåˆ†æ•£åœ¨å„å¤„çš„æ•°æ®è·å–ã€æ•°æ®å¤„ç†ã€ä¸šåŠ¡åˆ†ææ–¹æ³•ç»Ÿä¸€ç®¡ç†ï¼Œé€šè¿‡ç»Ÿä¸€æ¥å£è°ƒç”¨ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ€æƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ä»£ç                                   â”‚
â”‚  orchestrator = AStockOrchestrator()                        â”‚
â”‚  data = orchestrator.datahub.get_data("000001.SZ")         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Orchestrator Facade                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ComponentProxy (åŠ¨æ€ä»£ç†)                              â”‚ â”‚
â”‚  â”‚  orchestrator.datahub â†’ ComponentProxy("datahub")     â”‚ â”‚
â”‚  â”‚  .get_data(...)       â†’ è°ƒç”¨ execute()                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Registry (æ³¨å†Œä¸­å¿ƒ)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Index (ç´¢å¼•)     â”‚  â”‚ Strategies   â”‚  â”‚ Metrics (æŒ‡æ ‡)â”‚ â”‚
â”‚  â”‚ å¿«é€ŸæŸ¥æ‰¾æ–¹æ³•     â”‚  â”‚ é€‰æ‹©ç­–ç•¥     â”‚  â”‚ æ‰§è¡Œç»Ÿè®¡      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å·²æ³¨å†Œçš„æ–¹æ³•å®ç°                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ tushare      â”‚  â”‚ akshare      â”‚  â”‚ pandas       â”‚     â”‚
â”‚  â”‚ get_data()   â”‚  â”‚ get_data()   â”‚  â”‚ process()    â”‚ ... â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
orchestrator/
â”œâ”€â”€ __init__.py              # å¯¼å‡º AStockOrchestrator, register_method
â”œâ”€â”€ orchestrator.py          # Facade ä¸»ç±» + ComponentProxy åŠ¨æ€ä»£ç†
â”œâ”€â”€ models.py                # MethodRegistration æ•°æ®æ¨¡å‹
â”œâ”€â”€ config.py                # RegistryConfig é…ç½®
â”œâ”€â”€ errors.py                # è‡ªå®šä¹‰å¼‚å¸¸
â”œâ”€â”€ utils_version.py         # ç‰ˆæœ¬è§£æå·¥å…·
â”‚
â”œâ”€â”€ decorators/
â”‚   â””â”€â”€ register.py          # @register_method è£…é¥°å™¨
â”‚
â””â”€â”€ registry/
    â”œâ”€â”€ registry.py          # Registry å•ä¾‹ï¼šæ³¨å†Œ/é€‰æ‹©/æ‰§è¡Œ/ç»Ÿè®¡
    â”œâ”€â”€ index.py             # åˆ†å±‚ç´¢å¼•ï¼šcomponent -> method -> engine
    â”œâ”€â”€ strategies.py        # é€‰æ‹©ç­–ç•¥ï¼ˆdefault/latest/stable/priorityï¼‰
    â””â”€â”€ metrics.py           # æ‰§è¡ŒæŒ‡æ ‡æ”¶é›†
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### 1ï¸âƒ£ æ–¹æ³•æ³¨å†Œï¼ˆå¼€å‘è€…ï¼‰

å¼€å‘è€…åœ¨å„ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ `@register_method` è£…é¥°å™¨æ³¨å†Œæ–¹æ³•ï¼š

```python
# src/astock/datahub/tushare.py
from orchestrator import register_method

@register_method(
    component_type="datahub",      # ç»„ä»¶ç±»å‹ï¼ˆæ•°æ®è·å–ï¼‰
    engine_type="tushare",         # å¼•æ“ç±»å‹ï¼ˆä½¿ç”¨ Tushareï¼‰
    engine_name="get_data",        # æ–¹æ³•å
    version="1.0.0",               # ç‰ˆæœ¬
    priority=10,                   # ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§è¶Šä¼˜å…ˆï¼‰
    description="ä» Tushare è·å–è‚¡ç¥¨æ•°æ®"
)
def get_stock_data(stock_code: str):
    # å®ç°æ•°æ®è·å–é€»è¾‘
    return data
```

**æ³¨å†Œè¿‡ç¨‹**ï¼š
1. è£…é¥°å™¨åˆ›å»º `MethodRegistration` å¯¹è±¡ï¼ˆåŒ…å«å…ƒä¿¡æ¯ï¼‰
2. å°†æ–¹æ³•æ·»åŠ åˆ° `Registry` çš„ç´¢å¼•ä¸­
3. ç´¢å¼•ç»“æ„ï¼š`datahub -> get_data -> tushare -> MethodRegistration`

---

### 2ï¸âƒ£ æ–¹æ³•è°ƒç”¨ï¼ˆç”¨æˆ·ï¼‰

ç”¨æˆ·é€šè¿‡ Orchestrator ç»Ÿä¸€æ¥å£è°ƒç”¨æ–¹æ³•ï¼š

```python
from orchestrator import AStockOrchestrator

# åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨å‘ç°å¹¶åŠ è½½æ‰€æœ‰æ³¨å†Œçš„æ–¹æ³•ï¼‰
orchestrator = AStockOrchestrator(auto_discover=True)

# æ–¹å¼ 1ï¼šåŠ¨æ€å±æ€§è°ƒç”¨ï¼ˆæœ€ç®€æ´ï¼‰
data = orchestrator.datahub.get_data("000001.SZ")

# æ–¹å¼ 2ï¼šæ˜¾å¼è°ƒç”¨ï¼ˆæ”¯æŒç­–ç•¥é€‰æ‹©ï¼‰
data = orchestrator.execute(
    component_type="datahub",
    method_name="get_data",
    "000001.SZ",
    _strategy="latest"           # é€‰æ‹©æœ€æ–°ç‰ˆæœ¬
)

# æ–¹å¼ 3ï¼šæŒ‡å®šå¼•æ“è°ƒç”¨
data = orchestrator.execute_with_engine(
    component_type="datahub",
    engine_type="tushare",         # å¼ºåˆ¶ä½¿ç”¨ tushare
    method_name="get_data",
    "000001.SZ"
)
```

**è°ƒç”¨æµç¨‹**ï¼š
```
ç”¨æˆ·è°ƒç”¨
  â†“
ComponentProxy åŠ¨æ€ä»£ç†ï¼ˆorchestrator.datahub.get_dataï¼‰
  â†“
orchestrator.execute("datahub", "get_data", ...)
  â†“
Registry.execute()
  â†“
1. ä» Index ä¸­æŸ¥æ‰¾æ‰€æœ‰å€™é€‰æ–¹æ³•ï¼ˆæ‰€æœ‰å®ç° get_data çš„å¼•æ“ï¼‰
2. ä½¿ç”¨ Strategy é€‰æ‹©æœ€ä¼˜å®ç°ï¼ˆæ ¹æ®ä¼˜å…ˆçº§/ç‰ˆæœ¬/deprecateçŠ¶æ€ï¼‰
3. æ‰§è¡Œé€‰ä¸­çš„æ–¹æ³•
4. è®°å½•æ‰§è¡ŒæŒ‡æ ‡ï¼ˆMetricsï¼‰
5. è¿”å›ç»“æœ
```

---

### 3ï¸âƒ£ æ–¹æ³•é€‰æ‹©ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰

å½“åŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªå®ç°æ—¶ï¼ˆå¦‚ `get_data` æœ‰ tushareã€akshare ä¸¤ç§å®ç°ï¼‰ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ

**ç­–ç•¥åˆ—è¡¨**ï¼š

| ç­–ç•¥å | é€‰æ‹©é€»è¾‘ | ä½¿ç”¨åœºæ™¯ |
|--------|---------|---------|
| **default** | ä¼˜å…ˆçº§ > ç‰ˆæœ¬ > éåºŸå¼ƒ | é»˜è®¤ç­–ç•¥ï¼ˆæ¨èï¼‰ |
| **latest** | æœ€æ–°ç‰ˆæœ¬ > éåºŸå¼ƒ | éœ€è¦æœ€æ–°åŠŸèƒ½ |
| **stable** | éåºŸå¼ƒ > æœ€æ–°ç‰ˆæœ¬ | ç”Ÿäº§ç¯å¢ƒï¼Œè¿½æ±‚ç¨³å®š |
| **highest_priority** | æœ€é«˜ä¼˜å…ˆçº§ > ç‰ˆæœ¬ | æ˜ç¡®ä¼˜å…ˆçº§çš„åœºæ™¯ |
| **engine_override** | å¼ºåˆ¶æŒ‡å®šå¼•æ“ | æµ‹è¯•ç‰¹å®šå®ç° |

**ç¤ºä¾‹**ï¼š

å‡è®¾æœ‰ä¸¤ä¸ª `get_data` å®ç°ï¼š

```python
# å®ç° A
@register_method(..., engine_type="tushare", version="1.0.0", priority=10)

# å®ç° B
@register_method(..., engine_type="akshare", version="2.0.0", priority=5)
```

ä¸åŒç­–ç•¥çš„é€‰æ‹©ç»“æœï¼š

```python
# default: é€‰ tushareï¼ˆä¼˜å…ˆçº§ 10 > 5ï¼‰
orchestrator.datahub.get_data("000001.SZ")

# latest: é€‰ akshareï¼ˆç‰ˆæœ¬ 2.0.0 > 1.0.0ï¼‰
orchestrator.execute("datahub", "get_data", "000001.SZ", _strategy="latest")

# engine_override: å¼ºåˆ¶ä½¿ç”¨ akshare
orchestrator.execute_with_engine("datahub", "akshare", "get_data", "000001.SZ")
```

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£

### Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰æ–¹æ³•æ³¨å†Œ
- æ–¹æ³•æŸ¥æ‰¾å’Œé€‰æ‹©
- æ–¹æ³•æ‰§è¡Œå’ŒæŒ‡æ ‡æ”¶é›†

**å…³é”®æ–¹æ³•**ï¼š
```python
class Registry:
    def register(self, registration: MethodRegistration):
        """æ³¨å†Œä¸€ä¸ªæ–¹æ³•"""

    def select(self, component_type, method_name, strategy="default"):
        """é€‰æ‹©æœ€ä¼˜å®ç°"""

    def execute(self, component_type, method_name, *args, **kwargs):
        """æ‰§è¡Œæ–¹æ³•"""

    def auto_load(self, hot_reload=False):
        """è‡ªåŠ¨å‘ç°å¹¶åŠ è½½æ‰€æœ‰æ³¨å†Œçš„æ–¹æ³•"""
```

---

### Indexï¼ˆç´¢å¼•ï¼‰

**èŒè´£**ï¼šå¿«é€ŸæŸ¥æ‰¾æ–¹æ³•

**æ•°æ®ç»“æ„**ï¼š
```python
# ä¸‰å±‚ç´¢å¼•
by_component[component][method][engine] -> MethodRegistration

# ç¤ºä¾‹
by_component["datahub"]["get_data"]["tushare"] -> MethodRegistration(...)
by_component["datahub"]["get_data"]["akshare"] -> MethodRegistration(...)
```

**å…³é”®æ–¹æ³•**ï¼š
```python
class RegistryIndex:
    def method_candidates(self, component, method) -> List[MethodRegistration]:
        """è·å–æ‰€æœ‰å€™é€‰å®ç°"""
```

---

### ComponentProxyï¼ˆåŠ¨æ€ä»£ç†ï¼‰

**èŒè´£**ï¼šæä¾›ä¼˜é›…çš„è°ƒç”¨è¯­æ³•

**å·¥ä½œåŸç†**ï¼š
```python
# ç”¨æˆ·è°ƒç”¨
orchestrator.datahub.get_data("000001.SZ")

# ç­‰ä»·äº
orchestrator.execute("datahub", "get_data", "000001.SZ")
```

**å®ç°æœºåˆ¶**ï¼š
```python
class ComponentProxy:
    def __getattr__(self, method_name):
        def caller(*args, **kwargs):
            return self.o.execute(self.component_type, method_name, *args, **kwargs)
        return caller
```

---

## ğŸ“Š å®Œæ•´è°ƒç”¨æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·è°ƒç”¨                                                       â”‚
â”‚    orchestrator.datahub.get_data("000001.SZ")                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ComponentProxy åŠ¨æ€ä»£ç†                                       â”‚
â”‚    __getattr__("get_data") â†’ è¿”å› caller å‡½æ•°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AStockOrchestrator.execute()                                 â”‚
â”‚    extract: _strategy, _preferred_engine                        â”‚
â”‚    call: registry.execute()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Registry.execute()                                           â”‚
â”‚    a. ä» Index æŸ¥æ‰¾å€™é€‰æ–¹æ³•                                      â”‚
â”‚    b. ä½¿ç”¨ Strategy é€‰æ‹©æœ€ä¼˜å®ç°                                â”‚
â”‚    c. æ‰§è¡Œæ–¹æ³•                                                   â”‚
â”‚    d. è®°å½• Metrics                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Index.method_candidates("datahub", "get_data")              â”‚
â”‚    è¿”å›: [tushareå®ç°, akshareå®ç°]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Strategy.select(candidates)                                  â”‚
â”‚    DefaultStrategy: é€‰æ‹© tushareï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ‰§è¡Œé€‰ä¸­çš„æ–¹æ³•                                                â”‚
â”‚    tushare.get_stock_data("000001.SZ")                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è¿”å›ç»“æœ                                                       â”‚
â”‚    return data                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–°æ‰‹ä¸Šæ‰‹æŒ‡å—

### åœºæ™¯ 1ï¼šæ·»åŠ æ–°æ•°æ®æº

```python
# 1. åˆ›å»ºæ–‡ä»¶ï¼šsrc/astock/datahub/my_datasource.py
from orchestrator import register_method

@register_method(
    component_type="datahub",
    engine_type="my_datasource",
    engine_name="get_data",
    version="1.0.0",
    priority=8,
    description="æˆ‘çš„è‡ªå®šä¹‰æ•°æ®æº"
)
def get_data(stock_code: str):
    # å®ç°è·å–é€»è¾‘
    return {"code": stock_code, "data": [...]}

# 2. ä½¿ç”¨ï¼ˆè‡ªåŠ¨å‘ç°ï¼‰
orchestrator = AStockOrchestrator(auto_discover=True)
data = orchestrator.datahub.get_data("000001.SZ")
```

---

### åœºæ™¯ 2ï¼šæ·»åŠ æ–°ç»„ä»¶ç±»å‹

```python
# 1. åˆ›å»ºç›®å½•ï¼šsrc/astock/my_component/
# 2. åˆ›å»ºæ–‡ä»¶ï¼šsrc/astock/my_component/my_engine.py
from orchestrator import register_method

@register_method(
    component_type="my_component",  # æ–°ç»„ä»¶ç±»å‹
    engine_type="my_engine",
    engine_name="do_something",
    version="1.0.0"
)
def do_something(param):
    return f"Processing: {param}"

# 3. ä½¿ç”¨
orchestrator = AStockOrchestrator(auto_discover=True)
result = orchestrator.my_component.do_something("test")
```

---

### åœºæ™¯ 3ï¼šæµ‹è¯•ç‰¹å®šå®ç°

```python
# å¼ºåˆ¶ä½¿ç”¨ akshareï¼ˆä¸ä½¿ç”¨é»˜è®¤çš„ tushareï¼‰
data = orchestrator.execute_with_engine(
    component_type="datahub",
    engine_type="akshare",
    method_name="get_data",
    "000001.SZ"
)
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ Orchestratorï¼Ÿ

**æ²¡æœ‰ Orchestrator**ï¼š
```python
# åˆ†æ•£è°ƒç”¨ï¼Œéš¾ä»¥ç®¡ç†
from datahub.tushare import get_stock_data
from datahub.akshare import get_stock_data as get_stock_data_ak
from data_engines.pandas import process_data
from data_engines.polars import process_data as process_data_pl

data = get_stock_data("000001.SZ")  # åˆ‡æ¢æ•°æ®æºéœ€è¦æ”¹ä»£ç 
result = process_data(data)         # åˆ‡æ¢å¼•æ“éœ€è¦æ”¹ä»£ç 
```

**æœ‰ Orchestrator**ï¼š
```python
# ç»Ÿä¸€æ¥å£ï¼Œçµæ´»åˆ‡æ¢
orchestrator = AStockOrchestrator()
data = orchestrator.datahub.get_data("000001.SZ")        # è‡ªåŠ¨é€‰æœ€ä¼˜
result = orchestrator.data_engines.process_data(data)    # è‡ªåŠ¨é€‰æœ€ä¼˜
```

---

### Q2: æ–¹æ³•é€‰æ‹©ä¼˜å…ˆçº§å¦‚ä½•ç¡®å®šï¼Ÿ

**é»˜è®¤ç­–ç•¥ï¼ˆdefaultï¼‰æ’åº**ï¼š
1. **priority** æ•°å­—ï¼ˆè¶Šå¤§è¶Šä¼˜å…ˆï¼‰
2. **version** ç‰ˆæœ¬å·ï¼ˆè¶Šé«˜è¶Šä¼˜å…ˆï¼‰
3. **deprecated** æ˜¯å¦åºŸå¼ƒï¼ˆéåºŸå¼ƒä¼˜å…ˆï¼‰

---

### Q3: å¦‚ä½•è°ƒè¯•æ–¹æ³•é€‰æ‹©ï¼Ÿ

```python
# æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„æ‰€æœ‰å®ç°
info = orchestrator.describe("datahub", "get_data")
print(info)
# {
#   "implementations": [
#     {"engine_type": "tushare", "version": "1.0.0", "priority": 10},
#     {"engine_type": "akshare", "version": "2.0.0", "priority": 5}
#   ],
#   "selected": {"engine_type": "tushare", ...}
# }
```

---

## ğŸ“ æ€»ç»“

| æ¦‚å¿µ | ä½œç”¨ | ç±»æ¯” |
|------|------|------|
| **Orchestrator** | ç»Ÿä¸€è°ƒç”¨å…¥å£ | æ‰‹æœºåº”ç”¨å•†åº— |
| **Registry** | æ–¹æ³•æ³¨å†Œä¸­å¿ƒ | åº”ç”¨æ³¨å†Œè¡¨ |
| **@register_method** | æ³¨å†Œè£…é¥°å™¨ | åº”ç”¨ä¸Šæ¶ |
| **Strategy** | é€‰æ‹©ç­–ç•¥ | åº”ç”¨æ¨èç®—æ³• |
| **ComponentProxy** | åŠ¨æ€ä»£ç† | å¿«æ·æ–¹å¼ |

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰æ–¹æ³•é€šè¿‡ orchestrator è°ƒç”¨
- âœ… **çµæ´»åˆ‡æ¢**ï¼šæ— éœ€ä¿®æ”¹ä»£ç ï¼Œé€šè¿‡ç­–ç•¥é€‰æ‹©ä¸åŒå®ç°
- âœ… **è‡ªåŠ¨å‘ç°**ï¼šæ–°æ–¹æ³•è‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒå¤šç‰ˆæœ¬å…±å­˜ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°æ–¹æ³•åªéœ€è£…é¥°å™¨ï¼Œé›¶ä¾µå…¥

---

**ä¸‹ä¸€æ­¥**ï¼šé˜…è¯» [Pipeline æ¶æ„æ–‡æ¡£](./PIPELINE_ARCHITECTURE.md) äº†è§£å¦‚ä½•ç¼–æ’å¤šä¸ªæ–¹æ³•ä¸ºå·¥ä½œæµã€‚
